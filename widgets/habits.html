<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habit Checklist</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --fg:#e5e7eb; --muted:#9ca3af; --accent:#82A31A; --accent-weak:#3f6212; --ring:rgba(130,163,26,.35); }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--fg); display:grid; place-items:center; min-height:100dvh; }
    .wrap { width:min(600px,94vw); background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:20px clamp(16px,4vw,28px); box-shadow:0 10px 30px rgba(0,0,0,.4); }
    h1 { font-size:clamp(20px,3vw,26px); margin:0 0 16px; font-weight:600; text-align:center; }
    .list { display:grid; gap:10px; }
    .item { display:flex; align-items:center; gap:10px; background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px 12px; cursor:pointer; transition: background .2s; }
    .item:hover { background: rgba(255,255,255,.06); }
    .check { width:22px; height:22px; border-radius:6px; border:2px solid var(--muted); display:grid; place-items:center; font-size:14px; color:var(--accent); }
    .item.done .check { background:var(--accent); border-color:var(--accent); color:#0b0f19; }
    .label { flex:1; font-size:15px; }
    .footer { margin-top:14px; text-align:center; font-size:12px; color:var(--muted); }
    .progress { margin-top:12px; }
    .pbar { width:100%; height:10px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden; position:relative; box-shadow:0 0 0 4px var(--ring); }
    .pfill { height:100%; width:0%; background:linear-gradient(90deg, var(--accent), #b2ce35); transition: width .3s ease; }
    .pstats { margin-top:6px; text-align:center; font-size:12px; color:var(--muted); }
    .badge { margin-top:10px; text-align:center; font-size:13px; font-weight:700; color:#0b0f19; background:var(--accent); border:1px solid var(--accent-weak); box-shadow:0 6px 20px rgba(130,163,26,.35); padding:6px 10px; border-radius:999px; display:none; }
    .streak { margin-top:8px; text-align:center; font-size:12px; color:var(--muted); }
    .controls { margin-top:10px; display:flex; justify-content:center; }
    .btn { appearance:none; border:1px solid rgba(255,255,255,.08); color:var(--fg); background:rgba(255,255,255,.02); padding:8px 12px; border-radius:10px; font-size:12px; font-weight:600; cursor:pointer; }
    .btn:hover{ background: rgba(255,255,255,.06); }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="title">Habit Checklist</h1>
    <div class="list" id="list"></div>
    <div class="progress" id="progress">
      <div class="pbar"><div class="pfill" id="pfill"></div></div>
      <div class="pstats" id="pstats">0/0 completed â€¢ 0%</div>
      <div class="badge" id="badge">âœ… Day completed</div>
      <div class="streak" id="streak">ðŸ”¥ 0 days streak</div>
      <div class="controls"><button class="btn" id="resetBtn">Reset today</button></div>
    </div>
    <div class="footer" id="footer"></div>
  </div>
  <script>
    const qs = new URLSearchParams(location.search);
    function applyThemeFromParams(){
      const root=document.documentElement;
      ["bg","panel","fg","accent","ring"].forEach(p=>{
        if(qs.has(p)){
          const val=decodeURIComponent(qs.get(p));
          root.style.setProperty(`--${p}`,val);
          if(p==='accent') root.style.setProperty('--accent-weak',val);
        }
      });
    }
    applyThemeFromParams();
    const title = qs.get('title') ? decodeURIComponent(qs.get('title')) : 'Habit Checklist';
    const footer = qs.get('footer') ? decodeURIComponent(qs.get('footer')) : '';
    document.getElementById('title').textContent = title;
    document.getElementById('footer').textContent = footer;
    const listEl = document.getElementById('list');
    const pfill = document.getElementById('pfill');
    const pstats = document.getElementById('pstats');
    const badge = document.getElementById('badge');
    const streakEl = document.getElementById('streak');
    const resetBtn = document.getElementById('resetBtn');
    const habits = qs.get('habits') ? decodeURIComponent(qs.get('habits')).split(',') : ["Drink Water","Read 10 pages","Exercise"];
    const todayKey = new Date().toISOString().slice(0,10);
    const storageKey = `habit-checklist::${todayKey}::${location.search}`;
    let state = [];
    try{ state = JSON.parse(localStorage.getItem(storageKey))||[]; }catch{}
    function save(){ localStorage.setItem(storageKey, JSON.stringify(state)); }
    // goal
    const goalParam = parseInt(qs.get('goal')||'',10);
    let goal = Number.isFinite(goalParam) && goalParam > 0 ? goalParam : habits.length;
    goal = Math.min(goal, habits.length);
    // streak keys
    const wid = encodeURIComponent(location.search);
    const streakKey = `habit-streak::${wid}`;
    const lastValidKey = `habit-last-valid::${wid}`;
    const todayValidKey = `habit-today-valid::${todayKey}::${wid}`;
    function getStreak(){ return parseInt(localStorage.getItem(streakKey)||'0',10)||0; }
    function setStreak(n){ localStorage.setItem(streakKey, String(Math.max(0, n|0))); }
    function getLastValid(){ return localStorage.getItem(lastValidKey)||''; }
    function setLastValid(d){ if(d) localStorage.setItem(lastValidKey,d); else localStorage.removeItem(lastValidKey); }
    function getTodayFlag(){ return localStorage.getItem(todayValidKey)==='1'; }
    function setTodayFlag(v){ if(v) localStorage.setItem(todayValidKey,'1'); else localStorage.removeItem(todayValidKey); }
    function render(){
      listEl.innerHTML = '';
      habits.forEach((h,i)=>{
        const done = state.includes(i);
        const item = document.createElement('div');
        item.className = 'item'+(done?' done':'');
        item.innerHTML = `<div class="check">${done?'âœ”':''}</div><div class="label">${h}</div>`;
        item.addEventListener('click',()=>{
          if(state.includes(i)) state = state.filter(x=>x!==i); else state.push(i);
          save(); render();
        });
        listEl.appendChild(item);
      });
      const total = habits.length || 1;
      const doneCount = state.length;
      const pct = Math.round((doneCount/total)*100);
      pfill.style.width = pct + '%';
      pstats.textContent = `${doneCount}/${total} completed â€¢ ${pct}%`;
      const validated = doneCount >= goal;
      badge.style.display = validated ? 'inline-block' : 'none';
      let streak = getStreak();
      const lastValid = getLastValid();
      if (validated && !getTodayFlag()) {
        const y = new Date(); y.setDate(y.getDate()-1);
        const yKey = y.toISOString().slice(0,10);
        streak = (lastValid === yKey) ? streak + 1 : 1;
        setStreak(streak);
        setLastValid(todayKey);
        setTodayFlag(true);
      }
      const s = getStreak();
      streakEl.textContent = s>0 ? `ðŸ”¥ ${s} day${s>1?'s':''} streak` : '';
    }
    render();
    resetBtn.addEventListener('click', ()=>{
      const hadValidated = getTodayFlag();
      state = [];
      save();
      if (hadValidated) {
        const current = getStreak();
        setStreak(Math.max(0, current - 1));
        setLastValid('');
        setTodayFlag(false);
      }
      render();
    });
  </script>
</body>
</html>
